apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: k8s
    role: elasticsearch-rules
  name: percentils-containers-rules
  namespace: monitoring
spec:
  groups:
  - name: percentils_memory_working_set_bytes 
    rules:
    #p99
    - rule: avg_p99_container_memory_working_set_bytes
      expr: avg(quantile_over_time(.99,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])) by (container,pod,namespace)
      labels:
        evaluation: weekly
    - rule: p99_container_memory_working_set_bytes
      expr: quantile_over_time(.99,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])
      labels:
        evaluation: weekly
    #p95
    - rule: avg_p95_container_memory_working_set_bytes
      expr: avg(quantile_over_time(.95,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])) by (container,pod,namespace)
      labels:
        evaluation: weekly
    - rule: p95_container_memory_working_set_bytes
      expr: quantile_over_time(.95,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])
      labels:
        evaluation: weekly
    #p75
    - rule: avg_p75_container_memory_working_set_bytes
      expr: avg(quantile_over_time(.75,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])) by (container,pod,namespace)
      labels:
        evaluation: weekly
    - rule: p75_container_memory_working_set_bytes
      expr: quantile_over_time(.75,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])
      labels:
        evaluation: weekly
    #p25
    - rule: avg_p25_container_memory_working_set_bytes
      expr: avg(quantile_over_time(.25,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])) by (container,pod,namespace)
      labels:
        evaluation: weekly
    - rule: p25_container_memory_working_set_bytes
      expr: quantile_over_time(.25,container_memory_working_set_bytes{container_name!="POD",container!=""}[7d])
      labels:
        evaluation: weekly
