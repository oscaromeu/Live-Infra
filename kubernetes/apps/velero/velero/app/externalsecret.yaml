#apiVersion: external-secrets.io/v1alpha1
#kind: ExternalSecret
#metadata:
#  name: velero-s3-creds
#spec:
#  secretStoreRef:
#    kind: ClusterSecretStore
#    name: doppler-auth-api
#  target:
#    name: velero-s3-creds
#    template:
#      engineVersion: v2
#      data:
#        # multiline string
#        config: |
#          [default]
#          aws_access_key_id: "{{ .VELERO_AWS_ACCESS_KEY_ID}}"
#          aws_secret_access_key: "{{ .VELERO_AWS_SECRET_ACCESS_KEY}}"
#
#  dataFrom:
#    - extract:
#        key: VELERO



---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: velero-s3-creds
  namespace: default
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: doppler-auth-api
  target:
    name: velero-s3-creds
    creationPolicy: Owner
    deletionPolicy: "Delete"
    template:
      engineVersion: v2
      data:
        config: |
          [default]
          aws_secret_access_key: "{{ .VELERO_AWS_SECRET_ACCESS_KEY}}"

  data:
    - secretKey: VELERO_AWS_SECRET_ACCESS_KEY
      remoteRef:
        key: /VELERO/VELERO_AWS_SECRET_ACCESS_KEY
