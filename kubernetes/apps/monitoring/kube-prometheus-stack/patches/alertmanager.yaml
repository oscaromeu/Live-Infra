---
# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: kube-prometheus-stack
  namespace: monitoring
spec:
  values:
    alertmanager:
      fullnameOverride: alertmanager
      enabled: true
      #config:
      #  receivers:
      #    - name: "null"
      #    - name: "discord"
      #      webhook_configs:
      #        - url: "http://alertmanager-discord:9094"
      #          send_resolved: true
      #  route:
      #    group_by: ["alertname", "job"]
      #    group_wait: 30s
      #    group_interval: 5m
      #    repeat_interval: 6h
      #    receiver: "discord"
      #    routes:
      #      - receiver: "null"
      #        matchers:
      #          - alertname =~ "InfoInhibitor|Watchdog"
      #      - receiver: "discord"
      #        matchers:
      #          # - severity =~ critical|warning
      #          - severity = critical
      #        continue: true

      ingress:
        enabled: true
        ingressClassName: nginx
        annotations:
          hajimari.io/appName: "alertmanager"
          hajimari.io/enable: "true"
          hajimari.io/icon: "alarm-light-outline"
        hosts:
          - alertmanager.${SECRET_DOMAIN}
        paths:
          - /
        pathType: ImplementationSpecific
        tls:
          - hosts:
              - alertmanager.${SECRET_DOMAIN}
      alertmanagerSpec:
        #storage:
        #  volumeClaimTemplate:
        #    spec:
        #      storageClassName: ceph-block
        #      resources:
        #        requests:
        #          storage: 10Mi
        resources:
          requests:
            cpu: 50m
            memory: 64Mi
          limits:
            cpu: 60m
            memory: 64Mi
