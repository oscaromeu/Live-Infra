---
sources:

  k3s_networking_src:
    type: redis
    url: redis://redis-master.logging.svc.cluster.local:6379/0
    key: "k3s_prod:networking"

#transforms:
#
#  kubernetes_remap:
#    type: remap
#    inputs:
#      - kubernetes_source
#    source: |
#      # Standardize 'app' index
#      .app_name = .pod_labels."app.kubernetes.io/name" || .pod_labels.app || .pod_labels."k8s-app" || "unknown"


sinks:

  #kubernetes:
  #  type: console
  #  encoding:
  #    codec: "text"
  #  inputs:
  #    - k3s_networking_src


  elasticsearch:
    type: elasticsearch
    inputs:
      - k3s_networking_src
    auth:
      strategy: "basic"
      user: "ingestion"
      password: "monitor" # local temporal user for testing
    data_stream:
      # {data_stream.type}-{data_stream.dataset}-{data_stream.namespace}
      # https://www.elastic.co/guide/en/ecs/master/ecs-data_stream.html
      type: logs
      dataset: "k3s_prod"
      namespace: networking
    mode: "data_stream"
    bulk:
      action: "create"
    endpoints:
      - "https://elk-es-http.logging.svc.cluster.local:9200"
    tls:
      verify_certificate: false
