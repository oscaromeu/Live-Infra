---
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerSet
metadata:
  name: example
spec:
  replicas: 1
  labels: ["example"]
  repository: oscaromeu/fastapi-observability
  # Other mandatory fields from StatefulSet
  selector:
    matchLabels:
      app: example
  serviceName: example
  template:
    metadata:
      labels:
        app: example
---
apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerSet
metadata:
  name: self-hosted-cache
spec:
  replicas: 1
  repository: oscaromeu/fastapi-observability
  labels: ["self-hosted-cache"]
  dockerdWithinRunnerContainer: false
  selector:
    matchLabels:
      app: self-hosted-cache
  serviceName: self-hosted-cache
  template:
    metadata:
      labels:
        app: self-hosted-cache
    spec:
      containers:
        - name: runner
          env:
            - name: DOCKER_ENABLED
              value: "true"
            - name: DOCKERD_IN_RUNNER
              value: "false"
            - name: DOCKER_GROUP_GID
              value: "1001"
            - name: DOCKER_HOST
              value: unix:///run/docker/docker.sock
          volumeMounts:
            - name: docker-socket
              mountPath: /var/run/docker.sock
          image: summerwind/actions-runner:latest
          resources:
            {}
        - name: docker
          env:
            - name: DOCKER_GROUP_GID
              value: "1001"
          image: docker:dind
          resources:
            {}
          securityContext:
            privileged: true
  volumeClaimTemplates:
    - metadata:
        name: var-lib-docker
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: 3Gi
        storageClassName: openebs-hostpath
